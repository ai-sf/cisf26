{{ define "main" }}
{{ $home := .Site.GetPage "page" "home" }}
<div class="page-content" style="padding: 0 !important;">
    <!-- HERO SECTION -->
    <section class="homepage-hero">
        <div class="hero-video-container">
            <video
                    playsinline
                    autoplay
                    muted
                    loop
                    preload="metadata"
                    poster="images/rome-poster.jpg"
                    class="hero-video"
            >
                <source src="images/rome-clip.webm" type="video/webm">
                Il tuo browser non supporta il video.
            </video>
        </div>

        <div class="hero-overlay">
            {{ partial "cisf-logo.svg" . }}
        </div>
        <div class="hero-event-dates-overlay">
            {{ $home.Params.event_date | safeHTML }}
        </div>
    </section>

    <!-- ABOUT / DESCRIPTION -->
    {{ $guests := where .Site.RegularPages "Section" "guests" }}
    {{ $numGuests := len $guests }}
    <section class="about-section" data-animate>
        <div class="about-card">
            <div class="about-card-text">
                <h2 class="about-title">CISF</h2>
                <p>
                    La <strong>Conferenza Italiana Studenti di Fisica (CISF)</strong>, organizzata da AISF, è l’appuntamento
                    annuale dedicato a seminari con ricercatori di rilievo nazionale e internazionale, visite a laboratori e
                    centri di ricerca del Lazio, e momenti di scoperta e socialità nella città di Roma.
                </p>
            </div>
            <div class="about-card-image">
                <img src="images/mot-students-germany2.jpg" alt="Partecipanti CISF" />
            </div>
        </div>

        <div class="about-stats">
            <div class="stat-item">
                <i class="fa-solid fa-users" style="color: #993701"></i>
                <div>
                    <span class="stat-value">{{ $home.Params.attendees }}</span>
                    <span class="stat-label">Student* da tutta Italia</span>
                </div>
            </div>
            <div class="stat-item">
                <i class="fa-solid fa-microphone" style="color: #993701"></i>
                <div>
                    <span class="stat-value" id="guests-counter">{{ $numGuests }}</span>
                    <span class="stat-label">Speaker</span>
                </div>
            </div>
        </div>
    </section>

    <!-- SUBSCRIPTIONS -->
    <section class="subscriptions-section" data-animate>
        <h2 style="color: #ffffff; margin-top: 0">Iscriviti a CISF26</h2>
        <p class="subscriptions-subtitle">
            Per partecipare all'evento offriamo due possibilità.
        </p>

        <div class="fee-cards">
            <div class="fee-card">
                <div class="fee-price">
                    <span class="fee-euro">€</span><span class="fee-amount">120</span>
                </div>
                <ul class="fee-details">
                    <li>Pass 5 giorni</li>
                    <!-- <li>Pass ATAC</li> -->
                    <li>Alloggio</li>
                </ul>
            </div>

            <div class="fee-card">
                <div class="fee-price">
                    <span class="fee-euro">€</span><span class="fee-amount">70</span>
                </div>
                <ul class="fee-details">
                    <li>Pass 5 giorni</li>
                    <!-- <li>Pass ATAC</li> -->
                </ul>
            </div>
        </div>
    </section>

    <!-- CONTACT -->
    <section class="contact-section" data-animate>
        <h2>Domande? Contattaci!</h2>
        <form class="base-form" id="qa-form" target="hidden_iframe" onsubmit="formSubmitted()">
            <label class="base-field">
                <input type="text" id="name" placeholder="&nbsp;" />
                <span class="placeholder">Nome e Cognome*</span>
                <span class="border"></span>
            </label>

            <label class="base-field">
                <input type="text" id="email" placeholder="&nbsp;" />
                <span class="placeholder">Email*</span>
                <span class="border"></span>
            </label>

            <label class="base-field">
                <textarea id="message" placeholder="&nbsp;" maxlength="1000"></textarea>
                <span class="placeholder">Messaggio*</span>
                <span class="border"></span>
            </label>

            <button type="submit" class="submit-button">
                <span>Invia</span>
                <i class="fa-solid fa-paper-plane"></i>
            </button>

            <iframe name="hidden_iframe" style="display:none;"></iframe>
            <div id="gform-success" class="success-message">Messaggio inviato con successo!</div>
        </form>
    </section>

    <section class="sponsors-section" data-animate>
        <!-- Sponsors -->
        {{ $targetCategoryName := $home.Params.category }}
        {{ if $targetCategoryName }}
        {{ $categoryPages := first 1 (where (where .Site.RegularPages "Section" "partner-categories") ".Title" "eq" $targetCategoryName) }}
        {{ range $categoryPages }}
        {{ $catPartners := where (where $.Site.RegularPages "Section" "partners") "Params.category" .Title }}
        {{ if gt (len $catPartners) 0 }}
        <div class="partner-container-header" style='background-color: {{ .Params.bgColor }}'>
            <h2 style='color: {{ .Params.Color }}'>{{ .Title }}</h2>
        </div>
        {{ $sortedPartners := sort $catPartners "Params.order" }}
        {{ partial "partners-grid.html" (dict "partners" $sortedPartners "category" .) }}
        {{ end }}
        {{ end }}
        {{ end }}
    </section>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // FORM
        const form = document.getElementById("qa-form");
        const successMessage = document.getElementById("gform-success");
        const iframe = document.querySelector('iframe[name="hidden_iframe"]');
        const button = document.querySelector(".submit-button");
        let formSubmitted = false;

        form.addEventListener('submit', (e) => {
            formSubmitted = true;
        })

        function handleSubmit(event) {
            event.preventDefault();
            form.submit();
            formSubmitted = true;
        }

        iframe.addEventListener("load", function () {
            if (formSubmitted) {
                button.classList.add("success");
                successMessage.style.display = "block";

                setTimeout(() => {
                    button.classList.remove("success");
                    form.reset();
                    successMessage.style.display = "none";
                }, 3000);

                formSubmitted = false;
            }
        });
    })
</script>
{{ end }}