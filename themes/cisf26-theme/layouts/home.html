{{ define "main" }}
{{ $home := .Site.GetPage "page" "home" }}
<style>
    .homepage-hero {
        position: relative;
        width: 100%;
        height: 100vh;
    }

    .hero-video-container {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .hero-video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        opacity: 0;
        transition: opacity 1s ease-in-out;
    }

    .hero-video.loaded {
        opacity: 1;
    }

    .hero-video-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url('images/rome-poster.jpg');
        background-size: cover;
        background-position: center;
        opacity: 1;
        transition: opacity 1s ease-in-out;
        pointer-events: none;
        z-index: 1;
    }

    .hero-video-container.video-loaded::before {
        opacity: 0;
    }

    .hero-overlay,
    .hero-event-dates-overlay {
        position: absolute;
        z-index: 2;
    }

    /*.hero-overlay {*/
    /*    top: 50%;*/
    /*    left: 50%;*/
    /*    transform: translate(-50%, -50%);*/
    /*}*/

    .hero-event-dates-overlay {
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
    }
</style>

<div class="page-content" style="padding: 0 !important;">
    <!-- HERO SECTION -->
    <section class="homepage-hero">
        <div class="hero-video-container">
            <video
                playsinline
                autoplay
                muted
                loop
                preload="auto"
                poster="images/rome-poster.jpg"
                class="hero-video"
            >
                <source src="images/rome-clip.webm" type="video/webm">
                Il tuo browser non supporta il video.
            </video>
        </div>

        <div class="hero-overlay">
            {{ partial "cisf-logo.svg" . }}
        </div>
        <div class="hero-event-dates-overlay">
            {{ $home.Params.event_date | safeHTML }}
        </div>
    </section>

    <!-- CISF Section -->
    {{ partial "home-screen/cisf.html" . }}

    <!-- Students & Guests Section -->
    {{ partial "home-screen/students-and-guests.html" . }}

    <!-- Rome Section -->
    {{ partial "home-screen/rome.html" . }}

    <!-- SUBSCRIPTIONS -->
    {{ partial "home-screen/subscriptions.html" . }}

    <section class="sponsors-section" data-animate>
        <!-- Sponsors -->
        {{ $targetCategoryName := $home.Params.category }}
        {{ if $targetCategoryName }}
        {{ $categoryPages := first 1 (where (where .Site.RegularPages "Section" "partner-categories") ".Title" "eq" $targetCategoryName) }}
        {{ range $categoryPages }}
        {{ $catPartners := where (where $.Site.RegularPages "Section" "partners") "Params.category" .Title }}
        {{ if gt (len $catPartners) 0 }}
        <div class="partner-container-header" style='background-color: {{ .Params.bgColor }}'>
            <h2 style='color: {{ .Params.Color }}'>{{ .Title }}</h2>
        </div>
        {{ $sortedPartners := sort $catPartners "Params.order" }}
        {{ partial "partners-grid.html" (dict "partners" $sortedPartners "category" .) }}
        {{ end }}
        {{ end }}
        {{ end }}
    </section>

    <section class="sponsors-section" data-animate>
        <!-- Sponsors -->
        {{ $targetCategoryName := $home.Params.category_two }}
        {{ if $targetCategoryName }}
        {{ $categoryPages := first 1 (where (where .Site.RegularPages "Section" "partner-categories") ".Title" "eq" $targetCategoryName) }}
        {{ range $categoryPages }}
        {{ $catPartners := where (where $.Site.RegularPages "Section" "partners") "Params.category" .Title }}
        {{ if gt (len $catPartners) 0 }}
        <div class="partner-container-header" style='background-color: {{ .Params.bgColor }}'>
            <h2 style='color: {{ .Params.Color }}'>{{ .Title }}</h2>
        </div>
        {{ $sortedPartners := sort $catPartners "Params.order" }}
        {{ partial "partners-grid.html" (dict "partners" $sortedPartners "category" .) }}
        {{ end }}
        {{ end }}
        {{ end }}
    </section>

    <section class="sponsors-section" data-animate>
        <!-- Sponsors -->
        {{ $targetCategoryName := $home.Params.category_three }}
        {{ if $targetCategoryName }}
        {{ $categoryPages := first 1 (where (where .Site.RegularPages "Section" "partner-categories") ".Title" "eq" $targetCategoryName) }}
        {{ range $categoryPages }}
        {{ $catPartners := where (where $.Site.RegularPages "Section" "partners") "Params.category" .Title }}
        {{ if gt (len $catPartners) 0 }}
        <div class="partner-container-header" style='background-color: {{ .Params.bgColor }}'>
            <h2 style='color: {{ .Params.Color }}'>{{ .Title }}</h2>
        </div>
        {{ $sortedPartners := sort $catPartners "Params.order" }}
        {{ partial "partners-grid.html" (dict "partners" $sortedPartners "category" .) }}
        {{ end }}
        {{ end }}
        {{ end }}
    </section>

    <!-- CONTACT -->
    {{ partial "home-screen/contact-form.html" . }}


</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const video = document.querySelector('.hero-video');
        const container = document.querySelector('.hero-video-container');
        //
        // if (!video || !container) return;
        //
        // Wait for video to be sufficiently loaded
        video.addEventListener('canplaythrough', () => {
            video.play().then(() => {
                video.classList.add('loaded');
                container.classList.add('video-loaded');
            }).catch(err => {
                console.log('Autoplay failed:', err);
            });
        });
    });
</script>
{{ end }}